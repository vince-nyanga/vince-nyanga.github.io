<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Building a carpool web API with Django (part 6) | Vincent (Hones) Nyanga</title>
<meta name="description" content="In part 5 of our series we added more endpoints to our API. In this very short post we are going to add filtering support to our trips endpoint to allow users to filter trips.">


  <meta name="author" content="Vincent Nyanga">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_ZA">
<meta property="og:site_name" content="Vincent (Hones) Nyanga">
<meta property="og:title" content="Building a carpool web API with Django (part 6)">
<meta property="og:url" content="http://localhost:4000/building-a-carpooling-api-with-django-part-6/">


  <meta property="og:description" content="In part 5 of our series we added more endpoints to our API. In this very short post we are going to add filtering support to our trips endpoint to allow users to filter trips.">







  <meta property="article:published_time" content="2019-11-26T00:00:00+02:00">





  

  


<link rel="canonical" href="http://localhost:4000/building-a-carpooling-api-with-django-part-6/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Vincent Nyanga",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Vincent (Hones) Nyanga Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/img/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Vincent (Hones) Nyanga
          <span class="site-subtitle">Personal blog</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/" >Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/weekly-lessons/" >Weekly Lessons</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="https://avatars2.githubusercontent.com/u/13013852?v=3&u=0e1bc9da031c3b0fed315dcf2869b3cc38b7e232&s=400" alt="Vincent Nyanga" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Vincent Nyanga</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Software engineer</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Johannesburg, ZA</span>
        </li>
      

      
        
          
            <li><a href="https://www.linkedin.com/in/vincentnyanga/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://github.com/vince-nyanga/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Building a carpool web API with Django (part 6)">
    <meta itemprop="description" content="In part 5 of our series we added more endpoints to our API. In this very short post we are going to add filtering support to our trips endpoint to allow users to filter trips.">
    <meta itemprop="datePublished" content="November 26, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Building a carpool web API with Django (part 6)
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>In <a href="/building-a-carpooling-api-with-django-part-5/">part 5</a> of our series we added more endpoints to our API. In this very short post we are going to add filtering support to our <code class="highlighter-rouge">trips</code> endpoint to allow users to filter trips.</p>

<h2 id="install-django-filters">Install <code class="highlighter-rouge">django-filters</code></h2>

<p>First, letâ€™s install <code class="highlighter-rouge">django-filters</code>, a library that we are going to use. Ensure that your virtual environment is active by running <code class="highlighter-rouge">pipenv shell</code> then install the package:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipenv install django-filters
</code></pre></div></div>

<p>Next, we add it to our list of installed apps inside <code class="highlighter-rouge">kapool_project/settings.py</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># kapool_project/settings.py
</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...
</span>    <span class="s">'django_filters'</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div></div>

<p>We also need to add default filter backends to the <code class="highlighter-rouge">REST_FRAMEWORK</code> configuration:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># kapool_project/settings.py
</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...
</span>    <span class="s">'DEFAULT_FILTER_BACKENDS'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">'django_filters.rest_framework.DjangoFilterBackend'</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For more information on adding <code class="highlighter-rouge">django-filters</code> to your REST API check out the <a href="https://django-filter.readthedocs.io/en/master/guide/rest_framework.html">documentation</a>.</p>

<h2 id="trip-filterset">Trip <code class="highlighter-rouge">FilterSet</code></h2>

<p>Now letâ€™s add a <code class="highlighter-rouge">FilterSet</code> for our trip model. A <code class="highlighter-rouge">FilterSet</code> is class that is capable of automatically generating filters for a given <code class="highlighter-rouge">model</code>â€™s fields. Inside <code class="highlighter-rouge">trips/</code> directory create a file <code class="highlighter-rouge">filters.py</code> and add the following code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># trips/filters.py
</span>
<span class="kn">from</span> <span class="nn">django_filters</span> <span class="kn">import</span> <span class="n">rest_framework</span> <span class="k">as</span> <span class="n">filters</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Trip</span>


<span class="k">class</span> <span class="nc">TripFilter</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">FilterSet</span><span class="p">):</span>
    <span class="s">"""
    FilterSet for `Trip` model.
    """</span>

    <span class="n">num_seats</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">NumberFilter</span><span class="p">(</span>
        <span class="n">field_name</span><span class="o">=</span><span class="s">'num_seats'</span><span class="p">,</span>
        <span class="n">lookup_expr</span><span class="o">=</span><span class="s">'gte'</span><span class="p">)</span>

    <span class="n">origin</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">CharFilter</span><span class="p">(</span>
        <span class="n">field_name</span><span class="o">=</span><span class="s">'origin__name'</span><span class="p">,</span>
        <span class="n">lookup_expr</span><span class="o">=</span><span class="s">'iexact'</span><span class="p">)</span>

    <span class="n">destination</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">CharFilter</span><span class="p">(</span>
        <span class="n">field_name</span><span class="o">=</span><span class="s">'destination__name'</span><span class="p">,</span>
        <span class="n">lookup_expr</span><span class="o">=</span><span class="s">'iexact'</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Trip</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">'trip_date'</span><span class="p">,</span>
            <span class="s">'num_seats'</span><span class="p">,</span>
            <span class="s">'origin'</span><span class="p">,</span>
            <span class="s">'destination'</span><span class="p">,</span>
        <span class="p">]</span>

</code></pre></div></div>

<p>Our <code class="highlighter-rouge">FilterSet</code> will create filters for <code class="highlighter-rouge">trip_date</code>, <code class="highlighter-rouge">num_seats</code>, <code class="highlighter-rouge">origin</code> and <code class="highlighter-rouge">destination</code>.</p>

<p>Now letâ€™s go to <code class="highlighter-rouge">TripViewSet</code> add add our <code class="highlighter-rouge">FilterSet</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># trips/views.py
</span>
<span class="c1"># ...
</span><span class="kn">from</span> <span class="nn">.filters</span> <span class="kn">import</span> <span class="n">TripFilter</span>

<span class="k">class</span> <span class="nc">TripViewSet</span><span class="p">(</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="c1"># ...
</span>
    <span class="n">filterset_class</span> <span class="o">=</span> <span class="n">TripFilter</span> <span class="c1"># new
</span>
    <span class="c1"># ...
</span>
</code></pre></div></div>

<p>We are done! You can run your server <code class="highlighter-rouge">python manage.py runserver</code> and go to the <code class="highlighter-rouge">trips</code> endpoint and start filtering your trips. Here are the examples of how you will filter using each of the fields:</p>

<ul>
  <li><strong>trip_date</strong>: <code class="highlighter-rouge">api/v1/trips/?trip_date=2019-11-26</code></li>
  <li><strong>num_seats</strong>: <code class="highlighter-rouge">api/v1/trips/?num_seats=3</code></li>
  <li><strong>origin</strong>: <code class="highlighter-rouge">api/v1/trips/?origin=pretoria</code></li>
  <li><strong>destionation</strong>: <code class="highlighter-rouge">api/v1/trips/?destination=johannesburg</code></li>
  <li><strong>All fields</strong>: <code class="highlighter-rouge">api/v1/trips/?trip_date=2019-11-26&amp;num_seats=3&amp;origin=pretoria&amp;destination=johannesburg</code></li>
</ul>

<h2 id="what-did-we-do">What did we do?</h2>

<p>In this post we added filters for our <code class="highlighter-rouge">trips</code> endpoint to allow users of our API to filter trips on <code class="highlighter-rouge">trip_date</code>, <code class="highlighter-rouge">num_seats</code>, <code class="highlighter-rouge">origin</code> and <code class="highlighter-rouge">destination</code>. Thanks for taking your time to read. Hopefully you have learnt something new.</p>

<p>You may view the full source code on <a href="https://github.com/vince-nyanga/KaPool">GitHub</a>.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#django" class="page__taxonomy-item" rel="tag">Django</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#python" class="page__taxonomy-item" rel="tag">Python</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-11-26T00:00:00+02:00">November 26, 2019</time></p>
        
      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Building+a+carpool+web+API+with+Django+%28part+6%29%20http%3A%2F%2Flocalhost%3A4000%2Fbuilding-a-carpooling-api-with-django-part-6%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fbuilding-a-carpooling-api-with-django-part-6%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fbuilding-a-carpooling-api-with-django-part-6%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/building-a-carpooling-api-with-django-part-5/" class="pagination--pager" title="Building a carpool web API with Django (part 5)
">Previous</a>
    
    
      <a href="/building-a-carpooling-api-with-django-part-7/" class="pagination--pager" title="Building a carpool web API with Django (part 7)
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/creating-uml-diagrams-made-easy/" rel="permalink">Creating UML Diagrams With Ease Using PlantText
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Unified Modeling Language (UML) has been around the software development circles for a fairly long time now. It helps provide a standardised way to visualise...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/building-resilient-applications-with-polly-part-2/" rel="permalink">Building Resilient .NET Core Applications With Pollyâ€™s Circuit Breaker Policy
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">In the previous post we introduced Polly, a .NET resilience and transient-fault-handling library. We spoke about the retry policy that can be used to help yo...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/building-resilient-applications-with-polly-part-1/" rel="permalink">Building Resilient .NET Core Applications With Pollyâ€™s Retry Policy
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">In this age of Service Oriented Architecture (SOA) where small microservices within a system communicate with each other using various protocols, typically o...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/facial-recognition-with-kairos/" rel="permalink">Facial Recognition In .NET With Kairos
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">A little over 2 years ago I worked on a project that involved facial recognition. Even though I eventually used Python for the project, I initially wanted to...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://www.linkedin.com/in/vincentnyanga/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://github.com/vince-nyanga/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Vincent Nyanga.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
