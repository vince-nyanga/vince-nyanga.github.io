<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Android Architecture Components - Part 3 | Vincent (Hones) Nyanga</title>
<meta name="description" content="Welcome to part 3 of our series on Android Architecture Components. In the previous post we wrote tests for our database implementation to ensure that our database behaved in the manner we expect of it. In this post we are going to create a ViewModel and wire up the UI to add Tasks to our database and list them.">


  <meta name="author" content="Vincent Nyanga">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_ZA">
<meta property="og:site_name" content="Vincent (Hones) Nyanga">
<meta property="og:title" content="Android Architecture Components - Part 3">
<meta property="og:url" content="http://localhost:4000/android-architecture-components-part-3/">


  <meta property="og:description" content="Welcome to part 3 of our series on Android Architecture Components. In the previous post we wrote tests for our database implementation to ensure that our database behaved in the manner we expect of it. In this post we are going to create a ViewModel and wire up the UI to add Tasks to our database and list them.">







  <meta property="article:published_time" content="2017-06-22T00:00:00+02:00">





  

  


<link rel="canonical" href="http://localhost:4000/android-architecture-components-part-3/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Vincent Nyanga",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Vincent (Hones) Nyanga Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/img/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Vincent (Hones) Nyanga
          <span class="site-subtitle">Personal blog</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/" >Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/weekly-lessons/" >Weekly Lessons</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="https://avatars2.githubusercontent.com/u/13013852?v=3&u=0e1bc9da031c3b0fed315dcf2869b3cc38b7e232&s=400" alt="Vincent Nyanga" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Vincent Nyanga</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Software engineer</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Johannesburg, ZA</span>
        </li>
      

      
        
          
            <li><a href="https://www.linkedin.com/in/vincentnyanga/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://github.com/vince-nyanga/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Android Architecture Components - Part 3">
    <meta itemprop="description" content="Welcome to part 3 of our series on Android Architecture Components. In the previous post we wrote tests for our database implementation to ensure that our database behaved in the manner we expect of it. In this post we are going to create a ViewModel and wire up the UI to add Tasks to our database and list them.">
    <meta itemprop="datePublished" content="June 22, 2017">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Android Architecture Components - Part 3
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Welcome to part 3 of our series on Android Architecture Components. In the <a href="https://vince-nyanga.githubio/android-architecture-components-part-2/">previous post</a> we wrote tests for our database implementation to ensure that our database behaved in the manner we expect of it. In this post we are going to create a <code class="highlighter-rouge">ViewModel</code> and wire up the UI to add <code class="highlighter-rouge">Task</code>s to our database and list them.</p>

<h2 id="lets-get-started">Letâ€™s get started</h2>

<p>We will start by creating a repository class that will connect and interact with our database. As always get the complete code from <a href="https://github.com/vince-nyanga/yo-tasks">github</a>.</p>

<h3 id="repository">Repository</h3>

<p>Below is the code for the <code class="highlighter-rouge">Repository.java</code> class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataRepository</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="nc">YoTasksDb</span> <span class="n">db</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="nc">AppExecutors</span> <span class="n">appExecutors</span><span class="o">;</span>



    <span class="kd">public</span> <span class="nf">DataRepository</span><span class="o">(</span><span class="nc">YoTasksDb</span> <span class="n">db</span><span class="o">,</span> <span class="nc">AppExecutors</span> <span class="n">appExecutors</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">db</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">appExecutors</span> <span class="o">=</span> <span class="n">appExecutors</span><span class="o">;</span>

    <span class="o">}</span>


    <span class="kd">public</span> <span class="nc">LiveData</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;&gt;</span> <span class="nf">getAllTasks</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="na">taskDao</span><span class="o">().</span><span class="na">loadTasks</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addTask</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Task</span> <span class="n">task</span><span class="o">){</span>
        <span class="n">appExecutors</span><span class="o">.</span><span class="na">databaseIO</span><span class="o">().</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">db</span><span class="o">.</span><span class="na">taskDao</span><span class="o">().</span><span class="na">insert</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateTask</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Task</span> <span class="n">task</span><span class="o">){</span>
        <span class="n">appExecutors</span><span class="o">.</span><span class="na">databaseIO</span><span class="o">().</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">db</span><span class="o">.</span><span class="na">taskDao</span><span class="o">().</span><span class="na">update</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteTask</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Task</span> <span class="n">task</span><span class="o">){</span>
        <span class="n">appExecutors</span><span class="o">.</span><span class="na">databaseIO</span><span class="o">().</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">db</span><span class="o">.</span><span class="na">taskDao</span><span class="o">().</span><span class="na">delete</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<h3 id="tasklistviewmodel">TaskListViewModel</h3>

<p>Below is the code for the task list <code class="highlighter-rouge">ViewModel</code>. The <code class="highlighter-rouge">ViewModel</code> will connect to the database via the <code class="highlighter-rouge">Repository</code> class to get the list of tasks wrapped in a <code class="highlighter-rouge">LiveData</code> object and also to add new tasks to the database.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskListViewModel</span> <span class="kd">extends</span> <span class="nc">ViewModel</span> <span class="kd">implements</span> <span class="nc">Injectable</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">public</span> <span class="nc">DataRepository</span> <span class="n">repository</span><span class="o">;</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">inject</span><span class="o">(</span><span class="nc">TasksComponent</span> <span class="n">tasksComponent</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">tasksComponent</span><span class="o">.</span><span class="na">inject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">LiveData</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;&gt;</span> <span class="nf">getTasks</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">getAllTasks</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addTask</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">){</span>
        <span class="nc">Task</span> <span class="n">task</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Task</span><span class="o">();</span>
        <span class="n">task</span><span class="o">.</span><span class="na">setDateCreated</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
        <span class="n">task</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">repository</span><span class="o">.</span><span class="na">addTask</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now that we are done with the <code class="highlighter-rouge">ViewModel</code> and <code class="highlighter-rouge">Repository</code> letâ€™s turn our focus to the user interface. The UI will certainly not win best design of the year award but it will help us see how all these components will work together - which is the purpose of this series. We are going to create a <code class="highlighter-rouge">Fragment</code> that will <code class="highlighter-rouge">Task</code>s using a <code class="highlighter-rouge">RecyclerView</code>. Letâ€™s first create the view that will hold each <code class="highlighter-rouge">Task</code> first. Some of the code has been omitted from this post for brevity.</p>

<h3 id="task-list-item">Task list item</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;layout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
        <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;data&gt;</span>
        <span class="nt">&lt;variable</span>
            <span class="na">name=</span><span class="s">"task"</span>
            <span class="na">type=</span><span class="s">"com.mwiblo.yotasks.db.entity.Task"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;variable</span>
            <span class="na">name=</span><span class="s">"callback"</span>
            <span class="na">type=</span><span class="s">"com.mwiblo.yotasks.ui.tasks.TaskClickListener"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/data&gt;</span>

    <span class="nt">&lt;RelativeLayout</span>
        <span class="na">android:paddingStart=</span><span class="s">"16dp"</span>
        <span class="na">android:paddingLeft=</span><span class="s">"16dp"</span>
        <span class="na">android:paddingEnd=</span><span class="s">"16dp"</span>
        <span class="na">android:paddingRight=</span><span class="s">"16dp"</span>
        <span class="na">android:background=</span><span class="s">"?android:attr/selectableItemBackground"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:minHeight=</span><span class="s">"64dp"</span>
        <span class="na">android:clickable=</span><span class="s">"true"</span>
        <span class="na">android:focusable=</span><span class="s">"true"</span>
        <span class="na">android:onClick=</span><span class="s">"@{() -&gt; callback.onClick(task)}"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;TextView</span>
            <span class="na">android:id=</span><span class="s">"@+id/date"</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">app:date=</span><span class="s">"@{task.dateCreated}"</span>
            <span class="na">style=</span><span class="s">"@style/TextAppearance.AppCompat.Caption"</span>
            <span class="na">android:layout_alignParentRight=</span><span class="s">"true"</span>
            <span class="na">android:layout_alignParentEnd=</span><span class="s">"true"</span>
            <span class="na">android:layout_marginTop=</span><span class="s">"4dp"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;TextView</span>
            <span class="na">android:layout_below=</span><span class="s">"@+id/date"</span>
            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_marginTop=</span><span class="s">"8dp"</span>
            <span class="na">android:text=</span><span class="s">"@{task.name}"</span>
            <span class="na">style=</span><span class="s">"@style/TextAppearance.AppCompat.Title"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;View</span>
            <span class="na">android:layout_alignParentBottom=</span><span class="s">"true"</span>
            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
            <span class="na">android:layout_height=</span><span class="s">"1dp"</span>
            <span class="na">android:background=</span><span class="s">"#cccccc"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/RelativeLayout&gt;</span>
<span class="nt">&lt;/layout&gt;</span>
</code></pre></div></div>

<p>Letâ€™s also create the <code class="highlighter-rouge">RecyclerViewAdapter</code></p>

<h3 id="adapter">Adapter</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TasksAdapter</span> <span class="kd">extends</span> <span class="nc">RecyclerView</span><span class="o">.</span><span class="na">Adapter</span><span class="o">&lt;</span><span class="nc">TasksAdapter</span><span class="o">.</span><span class="na">TaskHolder</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>

    <span class="nd">@Nullable</span>
    <span class="kd">private</span> <span class="nc">TaskClickListener</span> <span class="n">clickListener</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">TasksAdapter</span><span class="o">(</span><span class="nc">TaskClickListener</span> <span class="n">clickListener</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">clickListener</span> <span class="o">=</span> <span class="n">clickListener</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">TaskHolder</span> <span class="nf">onCreateViewHolder</span><span class="o">(</span><span class="nc">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">TaskItemBinding</span> <span class="n">binding</span> <span class="o">=</span> <span class="nc">DataBindingUtil</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="nc">LayoutInflater</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">container</span>
                <span class="o">.</span><span class="na">getContext</span><span class="o">()),</span> <span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">task_item</span><span class="o">,</span><span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">binding</span><span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="n">clickListener</span><span class="o">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">TaskHolder</span><span class="o">(</span><span class="n">binding</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onBindViewHolder</span><span class="o">(</span><span class="nc">TaskHolder</span> <span class="n">taskHolder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">taskHolder</span><span class="o">.</span><span class="na">binding</span><span class="o">.</span><span class="na">setTask</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">));</span>
        <span class="n">taskHolder</span><span class="o">.</span><span class="na">binding</span><span class="o">.</span><span class="na">executePendingBindings</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getItemCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">list</span> <span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTaskList</span><span class="o">(</span><span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;</span> <span class="n">newList</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">list</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="k">this</span><span class="o">.</span><span class="na">list</span> <span class="o">=</span> <span class="n">newList</span><span class="o">;</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="nc">DiffUtil</span><span class="o">.</span><span class="na">DiffResult</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">DiffUtil</span><span class="o">.</span><span class="na">calculateDiff</span><span class="o">(</span><span class="k">new</span> <span class="nc">DiffUtil</span><span class="o">.</span><span class="na">Callback</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getOldListSize</span><span class="o">()</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
                <span class="o">}</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNewListSize</span><span class="o">()</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
                <span class="o">}</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">areItemsTheSame</span><span class="o">(</span><span class="kt">int</span> <span class="n">oldPosition</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newPosition</span><span class="o">)</span> <span class="o">{</span>
                     <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oldPosition</span><span class="o">).</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="n">newList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">newPosition</span><span class="o">).</span><span class="na">getId</span><span class="o">();</span>
                <span class="o">}</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">areContentsTheSame</span><span class="o">(</span><span class="kt">int</span> <span class="n">oldPosition</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newPosition</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oldPosition</span><span class="o">).</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="n">newList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">newPosition</span><span class="o">).</span><span class="na">getId</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">});</span>
            <span class="n">list</span> <span class="o">=</span> <span class="n">newList</span><span class="o">;</span>
            <span class="n">result</span><span class="o">.</span><span class="na">dispatchUpdatesTo</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>


    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">TaskHolder</span> <span class="kd">extends</span> <span class="nc">RecyclerView</span><span class="o">.</span><span class="na">ViewHolder</span><span class="o">{</span>

        <span class="kd">final</span> <span class="nc">TaskItemBinding</span> <span class="n">binding</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">TaskHolder</span><span class="o">(</span><span class="nc">TaskItemBinding</span> <span class="n">binding</span><span class="o">){</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">binding</span><span class="o">.</span><span class="na">getRoot</span><span class="o">());</span>
            <span class="k">this</span><span class="o">.</span><span class="na">binding</span> <span class="o">=</span> <span class="n">binding</span><span class="o">;</span>


        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Then the <code class="highlighter-rouge">Fragment</code>:</p>

<h3 id="task-list-fragment">Task List Fragment</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskListFragment</span> <span class="kd">extends</span> <span class="nc">LifecycleFragment</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">TasksAdapter</span> <span class="n">tasksAdapter</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">ListFragmentBinding</span> <span class="n">binding</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">TaskClickListener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TaskClickListener</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">Task</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// non-imp</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">private</span> <span class="nc">AddTaskCallback</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AddTaskCallback</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">()</span> <span class="o">{</span>
            <span class="c1">// Not a very good idea...</span>
            <span class="o">((</span><span class="nc">MainActivity</span><span class="o">)</span><span class="n">getActivity</span><span class="o">()).</span><span class="na">showAddTaskView</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nd">@Nullable</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="nc">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">binding</span> <span class="o">=</span> <span class="nc">DataBindingUtil</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">inflater</span><span class="o">,</span> <span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">list_fragment</span><span class="o">,</span> <span class="n">container</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">tasksAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TasksAdapter</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
        <span class="n">binding</span><span class="o">.</span><span class="na">tasksList</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">tasksAdapter</span><span class="o">);</span>
        <span class="n">binding</span><span class="o">.</span><span class="na">setIsListEmpty</span><span class="o">(</span><span class="n">tasksAdapter</span><span class="o">.</span><span class="na">getItemCount</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">binding</span><span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="n">callback</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">binding</span><span class="o">.</span><span class="na">getRoot</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onActivityCreated</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onActivityCreated</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="kd">final</span> <span class="nc">TaskListViewModel</span> <span class="n">viewModel</span> <span class="o">=</span> <span class="nc">ViewModelProviders</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ViewModelFactory</span><span class="o">(</span>
                <span class="o">(</span><span class="nc">YoTasksApp</span><span class="o">)</span><span class="n">getActivity</span><span class="o">().</span><span class="na">getApplication</span><span class="o">())).</span><span class="na">get</span><span class="o">(</span><span class="nc">TaskListViewModel</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">viewModel</span><span class="o">.</span><span class="na">getTasks</span><span class="o">().</span><span class="na">observe</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Observer</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onChanged</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;</span> <span class="n">tasks</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">tasksAdapter</span><span class="o">.</span><span class="na">setTaskList</span><span class="o">(</span><span class="n">tasks</span><span class="o">);</span>
                <span class="n">binding</span><span class="o">.</span><span class="na">setIsListEmpty</span><span class="o">(</span><span class="n">tasks</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">tasks</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">():</span> <span class="kc">true</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In our <code class="highlighter-rouge">Fragment</code> we create our <code class="highlighter-rouge">ViewModel</code> and hook it up to the lifecycle of the <code class="highlighter-rouge">Fragment</code> in this line of code:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">TaskListViewModel</span> <span class="n">viewModel</span> <span class="o">=</span> <span class="nc">ViewModelProviders</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ViewModelFactory</span><span class="o">(</span>
                <span class="o">(</span><span class="nc">YoTasksApp</span><span class="o">)</span><span class="n">getActivity</span><span class="o">().</span><span class="na">getApplication</span><span class="o">())).</span><span class="na">get</span><span class="o">(</span><span class="nc">TaskListViewModel</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre></div></div>

<p>Note that the class extends <code class="highlighter-rouge">LifecycleFragment</code>. <code class="highlighter-rouge">LifecycleFragment</code> is a <code class="highlighter-rouge">Fragment</code> that is also a <code class="highlighter-rouge">LifecycleOwner</code>. This class is a temporary implementation until Lifecycles are integrated in the support library. If you donâ€™t want your <code class="highlighter-rouge">Fragment</code> to extend <code class="highlighter-rouge">LifecycleFragment</code> you should implement <code class="highlighter-rouge">LifecycleRegistryOwner</code> like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyFragment</span> <span class="kd">extends</span> <span class="nc">Fragment</span> <span class="kd">implements</span> <span class="nc">LifecycleRegistryOwner</span> <span class="o">{</span>

    <span class="kd">final</span> <span class="nc">LifecycleRegistry</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LifecycleRegistry</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">LifecycleRegistry</span> <span class="nf">getLifecycle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span>  <span class="n">registry</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now we can subscribe to the Task list wrapped around a <code class="highlighter-rouge">LiveData</code> object:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">viewModel</span><span class="o">.</span><span class="na">getTasks</span><span class="o">().</span><span class="na">observe</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Observer</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onChanged</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Task</span><span class="o">&gt;</span> <span class="n">tasks</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">tasksAdapter</span><span class="o">.</span><span class="na">setTaskList</span><span class="o">(</span><span class="n">tasks</span><span class="o">);</span>
                <span class="n">binding</span><span class="o">.</span><span class="na">setIsListEmpty</span><span class="o">(</span><span class="n">tasks</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">tasks</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">():</span> <span class="kc">true</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
</code></pre></div></div>

<p>Since the Room library works with LiveData seamlessly, when there is any change in the data in our database the UI will get notified and update accordingly.</p>

<h2 id="summary">Summary</h2>

<p>In this post we linked our data to the UI using a <code class="highlighter-rouge">ViewModel</code> class. This is probably the last part in this series unless if something comes up that I will need to talk about. I will however finish the app on github so you may need to keep an eye on it if you are interested in seeing how the app will be put together. The main objective of this series was to introduce the super cool Android Architecture Components. I have learnt a lot about these components (though I donâ€™t know it all yet) during this series and I hope youâ€™ll be encouraged to look into them further.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#android" class="page__taxonomy-item" rel="tag">Android</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#architecture" class="page__taxonomy-item" rel="tag">Architecture</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-06-22T00:00:00+02:00">June 22, 2017</time></p>
        
      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Android+Architecture+Components+-+Part+3%20http%3A%2F%2Flocalhost%3A4000%2Fandroid-architecture-components-part-3%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fandroid-architecture-components-part-3%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fandroid-architecture-components-part-3%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/android-architecture-components-part-2/" class="pagination--pager" title="Android Architecture Components - Part 2
">Previous</a>
    
    
      <a href="/android-instant-apps-theory/" class="pagination--pager" title="Android Instant Apps - theory
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/creating-uml-diagrams-made-easy/" rel="permalink">Creating UML Diagrams With Ease Using PlantText
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Unified Modeling Language (UML) has been around the software development circles for a fairly long time now. It helps provide a standardised way to visualise...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/building-resilient-applications-with-polly-part-2/" rel="permalink">Building Resilient .NET Core Applications With Pollyâ€™s Circuit Breaker Policy
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">In the previous post we introduced Polly, a .NET resilience and transient-fault-handling library. We spoke about the retry policy that can be used to help yo...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/building-resilient-applications-with-polly-part-1/" rel="permalink">Building Resilient .NET Core Applications With Pollyâ€™s Retry Policy
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">In this age of Service Oriented Architecture (SOA) where small microservices within a system communicate with each other using various protocols, typically o...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/facial-recognition-with-kairos/" rel="permalink">Facial Recognition In .NET With Kairos
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">A little over 2 years ago I worked on a project that involved facial recognition. Even though I eventually used Python for the project, I initially wanted to...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://www.linkedin.com/in/vincentnyanga/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://github.com/vince-nyanga/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Vincent Nyanga.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
